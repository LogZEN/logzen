{% extends "base.html" %}

{% if searchengine == "google" %}
  {% set searchengine = "https://www.google.com/search?q=" %}
  {% set searchengine_name = "Google" %}
{% else %}
  {% set searchengine = "https://ixquick.com/do/search?q=" %}
  {% set searchengine_name = "ixquick" %}
{% endif %}

{% block title %}Events{% endblock %}

{% block content %}

<div id="loading" data-bind="visible: loading"></div>

<!--  ko if: error -->
<div class="row-fluid">
  <div class="span12">
    <div class="alert alert-block alert-error">
      <strong>Error:</strong>
      <span data-bind="text: error"></span>
    </div>
  </div>
</div>
<!-- /ko -->

Showing events <span data-bind="text: page() * 50 + 1"></span> - <span data-bind="text: page() * 50 + 50"></span>
<div class="row-fluid">
  <div class="span12">
  	<div id="navi" class="btn-toolbar">
    	<div class="btn-group">
    		<a class="btn left q_tip" title="Newer" href="javascript:void(0);" data-bind="click: $root.prevPage">Prev</a>
    		<a class="btn right q_tip" title="Older" href="javascript:void(0);" data-bind="click: $root.nextPage">Next</a>
    	</div>
    </div>
  </div>
</div>

<div class="row-fluid">
 	<div class="span12">
	  <div id="timeSeries" style="width: 100%"><svg></svg></div>
 	</div>
</div>

<div class="row-fluid">
  <form action="/_api/query" method="post" id="filterform" class="form-inline">
  <table id="events" class="table-condensed">
    <thead>
      <tr id="first">
        <th class="column_menu"></th>
        <th colspan="2">Time</th>
        <th colspan="2">Severity</th>
        <th colspan="2">Facility</th>
        <th colspan="2">Host</th>
        <th colspan="2">Program</th>
        <th colspan="2">Message</th>
      </tr>
      <tr>
        <th class="column_menu"></th>
        <th class="input-col" id="column_time">
          <input type="text" name="timereported" id="filter_time" placeholder="filter" readonly="readonly" size="5" />
        </th>
        <th class="clear-col"><span class="q_tip clear-addon btn" id="time" title="Clear this filter">x</span></th>
        <th class="input-col" id="column_severity">
          <input type="text" name="severity" id="filter_severity" class="filter" placeholder="filter" size="5" data-bind="value: filters.severity, valueUpdate: 'afterkeydown'" data-provide="typeahead" data-items="4" data-source='["emerge","alert","critical","error","warning","notice","info","debug"]' />
        </th>
        <th class="clear-col"><span class="q_tip clear-addon btn" id="severity" title="Clear this filter" data-bind="click: $root.clearFilter('severity')">x</span></th>
        <th class="input-col" id="column_facility">
          <input type="text" name="facility" id="filter_facility" class="filter" placeholder="filter" size="5" data-bind="value: filters.facility, valueUpdate: 'afterkeydown'" />
        </th>
        <th class="clear-col"><span class="q_tip clear-addon btn" id="facility" title="Clear this filter" data-bind="click: $root.clearFilter('facility')">x</span></th>
        <th class="input-col" id="column_host">
          <input type="text" name="fromhost" id="filter_fromhost" class="filter" placeholder="filter" size="5" data-bind="value: filters.host, valueUpdate: 'afterkeydown'" />
        </th>
        <th class="clear-col"><span class="q_tip clear-addon btn" id="fromhost" title="Clear this filter" data-bind="click: $root.clearFilter('host')">x</span></th>
        <th class="input-col" id="column_program">
          <input type="text" name="program" id="filter_program" class="filter" placeholder="filter" size="5" data-bind="value: filters.program, valueUpdate: 'afterkeydown'" />
        </th>
        <th class="clear-col"><span class="q_tip clear-addon btn" id="program" title="Clear this filter" data-bind="click: $root.clearFilter('program')">x</span></th>
        <th class="input-col" id="column_message">
          <input type="text" name="message" id="filter_message" class="filter" placeholder="filter" size="5" data-bind="value: filters.message, valueUpdate: 'afterkeydown'" />
        </th>
        <th class="clear-col"><span class="q_tip clear-addon btn" id="message" title="Clear this filter" data-bind="click: $root.clearFilter('message')">x</span></th>
      </tr>
    </thead>

    <tbody>
    <!-- ko foreach: events -->
  	  <tr>
  	    <td class="column_menu">
  	      <ul class="nav hover-nav" style="display:inline-block">
  	        <li class="dropdown">
  	        <a class="dropdown-toggle" href="#"><i class="icon-chevron-down"></i></a>
  	          <ul class="dropdown-menu">
  	            <li><a data-bind="attr: { href: detail_url}"><i class="icon-info-sign"></i> Display details</a></li>
  	            <li><a href="{{searchengine}}' + encodeURIComponent() + '"><i class="icon-globe"></i> Search with {{searchengine_name}}</a></li>
  	          </ul>
  	        </li>
  	      </ul>
  	      <i class="icon-eye-open event_tooltip" title="<%_id%>"></i>
  	    </td>
  	    
  	    <td colspan="2" data-bind="text: time"></td>
  	    <td colspan="2"><a data-bind="text: severity_text, click: $root.setFilter('severity'), css: {
  		    color_emerge: severity == '0',
  		    color_alert: severity == '1',
  		    color_critical: severity == '2',
  		    color_error: severity == '3',
  		    color_warning: severity == '4',
  		    color_notice: severity == '5',
  		    color_info: severity == '6',
  		    color_debug: severity == '7'
  	    }" class="badge"></a></td>
  	    <td colspan="2"><a data-bind="text: facility_text,  click: $root.setFilter('facility')"></a></td>
        <td colspan="2"><a data-bind="text: host,           click: $root.setFilter('host')"></a></td>
        <td colspan="2"><a data-bind="text: program,        click: $root.setFilter('program')"></a></td>
  	    <td colspan="2"><a data-bind="html: message_hl,     click: $root.setFilter('message')"></a></td>
  	  </tr>
	  <!-- /ko -->
    
    <!--  ko ifnot: events().length -->
      <tr><td colspan="13" id="noresults">No Events</td></tr>
	  <!-- /ko -->
    </tbody>
    
  </table>
  </form>
</div>

<script type="text/javascript" src="/static/js/eventlist.js"></script>


{% endblock %}