// Generated by CoffeeScript 1.3.3

/*
Copyright 2012 Sven Reissmann <sven@0x80.io>

This file is part of pyLogView. It is licensed under the terms of the
GNU General Public License version 3. See <http://www.gnu.org/licenses/>.
*/


(function() {
  var Eventlist, evlist,
    _this = this;

  Eventlist = (function() {

    function Eventlist() {
      var timerange;
      timerange = [];
    }

    Eventlist.prototype.displayLoadingIcon = function() {
      return $("#loading").show();
    };

    Eventlist.prototype.getFilters = function() {
      var result,
        _this = this;
      result = {};
      $('.filter').each(function(index, element) {
        if ($(element).val() !== "") {
          return result[$(element).attr('name')] = $(element).val();
        }
      });
      if (JSON.stringify(result) === "{}") {
        return {
          "match_all": {}
        };
      } else {
        return {
          "term": result
        };
      }
    };

    Eventlist.prototype.loadEvents = function() {
      var es_query;
      es_query = {
        "query": evlist.getFilters(),
        "facets": {
          "range1": {
            "range": {
              "field": "timereported",
              "ranges": {
                "from": "2012",
                "to": "2012"
              }
            }
          }
        }
      };
      return $.ajax({
        url: $('#filterform').attr('action'),
        type: 'POST',
        contentType: "application/json",
        data: JSON.stringify(es_query),
        dataType: 'json',
        success: evlist.handleResult,
        beforeSend: evlist.displayLoadingIcon
      });
    };

    Eventlist.prototype.handleResult = function(result) {
      return console.log(JSON.stringify(result));
    };

    Eventlist.prototype.plotGraph = function(data, tickrange) {
      var options, plot;
      return plot = $.plot($('#chartdiv'), [data], options = {
        xaxis: {
          ticks: tickrange
        },
        bars: {
          show: true,
          lineWidth: 1,
          fill: true,
          fillColor: {
            colors: ["#729fcf", "#3465af"]
          }
        },
        grid: {
          hoverable: true,
          autoHighlight: true
        },
        tooltip: true,
        tooltipOpts: {
          content: "%y",
          defaultTheme: false
        },
        colors: ["#204a87"],
        selection: {
          mode: "x"
        }
      });
    };

    return Eventlist;

  })();

  evlist = new Eventlist;

  evlist.plotGraph([[0, 0], [0, 0]], []);

  evlist.loadEvents();

  $('#filterform').bind('keyup', function(event) {
    return evlist.loadEvents();
  });

  $(".clear-addon").each(function(index, element) {
    return $(element).bind('click', function(event) {
      $("#filter_" + $(element).attr("id")).val("");
      return evlist.loadEvents();
    });
  });

  $("#chartdiv").bind('plotselected', function(event) {
    return evlist.loadEvents();
  });

}).call(this);
